<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö - Steamphony Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö - Steamphony Calculator</h1>
    
    <div class="test-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ AppState</h2>
        <button onclick="testAppState()">–¢–µ—Å—Ç AppState</button>
        <div id="appstate-result"></div>
    </div>

    <div class="test-section">
        <h2>2. –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</h2>
        <button onclick="testDataSaving()">–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</button>
        <div id="saving-result"></div>
    </div>

    <div class="test-section">
        <h2>3. –¢–µ—Å—Ç —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
        <button onclick="testCalculation()">–¢–µ—Å—Ç —Ä–∞—Å—á–µ—Ç–∞</button>
        <div id="calculation-result"></div>
    </div>

    <div class="test-section">
        <h2>4. –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
        <button onclick="testFullFlow()">–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç</button>
        <div id="fullflow-result"></div>
    </div>

    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏
        import { AppState } from './src/core/AppState.js';
        import { calculator } from './src/core/Calculator.js';

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
        window.testAppState = function() {
            const resultDiv = document.getElementById('appstate-result');
            try {
                const appState = AppState.getInstance();
                
                // –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
                appState.updateField('industry', { key: 'restaurant', title: '–†–µ—Å—Ç–æ—Ä–∞–Ω' });
                appState.updateField('businessSize', { key: 'medium', title: '–°—Ä–µ–¥–Ω–∏–π' });
                appState.updateField('marketingBudget', { budget: 500000, monthly: 500000 });
                appState.updateField('marketingTeam', { teamId: 'freelancer', monthlyCost: 80000 });
                appState.updateField('marketingTools', { 
                    selected: ['seo', 'ppc'], 
                    estimatedMonthlyCost: 120000 
                });

                const formData = appState.getFormDataForComponents();
                
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        ‚úÖ AppState —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                    </div>
                    <pre>${JSON.stringify(formData, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        ‚ùå –û—à–∏–±–∫–∞ AppState: ${error.message}
                    </div>
                `;
            }
        };

        window.testDataSaving = function() {
            const resultDiv = document.getElementById('saving-result');
            try {
                const appState = AppState.getInstance();
                
                // –°–∏–º—É–ª–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                const testData = {
                    industry: { key: 'restaurant', title: '–†–µ—Å—Ç–æ—Ä–∞–Ω–Ω—ã–π –±–∏–∑–Ω–µ—Å' },
                    businessSize: { key: 'medium', title: '–°—Ä–µ–¥–Ω–∏–π –±–∏–∑–Ω–µ—Å' },
                    marketingBudget: { budget: 300000, monthly: 300000 },
                    marketingTeam: { teamId: 'agency', monthlyCost: 150000 },
                    marketingTools: { 
                        selected: ['seo', 'ppc', 'social'], 
                        estimatedMonthlyCost: 180000 
                    }
                };

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                Object.entries(testData).forEach(([key, value]) => {
                    appState.updateField(key, value);
                });

                const savedData = appState.getFormDataForComponents();
                
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                    </div>
                    <pre>${JSON.stringify(savedData, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        ‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${error.message}
                    </div>
                `;
            }
        };

        window.testCalculation = function() {
            const resultDiv = document.getElementById('calculation-result');
            try {
                const appState = AppState.getInstance();
                const formData = appState.getFormDataForComponents();
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞—Å—á–µ—Ç
                const currentCosts = formData.budget + (formData.marketingTeam?.monthlyCost || 0) + (formData.marketingTools?.estimatedMonthlyCost || 0);
                const steamphonyCosts = Math.round((formData.marketingTools?.estimatedMonthlyCost || 0) * 0.7);
                const savings = Math.max(currentCosts - steamphonyCosts, 0);
                const roi = steamphonyCosts > 0 ? Math.round((savings / steamphonyCosts) * 100) : 0;
                
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        ‚úÖ –†–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                    </div>
                    <div class="test-result info">
                        <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞:</strong><br>
                        –¢–µ–∫—É—â–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã: ${currentCosts.toLocaleString()} ‚ÇΩ/–º–µ—Å<br>
                        –ó–∞—Ç—Ä–∞—Ç—ã Steamphony: ${steamphonyCosts.toLocaleString()} ‚ÇΩ/–º–µ—Å<br>
                        –≠–∫–æ–Ω–æ–º–∏—è: ${savings.toLocaleString()} ‚ÇΩ/–º–µ—Å<br>
                        ROI: ${roi}%
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        ‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞: ${error.message}
                    </div>
                `;
            }
        };

        window.testFullFlow = function() {
            const resultDiv = document.getElementById('fullflow-result');
            try {
                const appState = AppState.getInstance();
                
                // –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                console.log('üß™ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
                
                // 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                appState.updateField('industry', { key: 'restaurant', title: '–†–µ—Å—Ç–æ—Ä–∞–Ω–Ω—ã–π –±–∏–∑–Ω–µ—Å' });
                appState.updateField('businessSize', { key: 'large', title: '–ö—Ä—É–ø–Ω—ã–π –±–∏–∑–Ω–µ—Å' });
                appState.updateField('marketingBudget', { budget: 800000, monthly: 800000 });
                appState.updateField('marketingTeam', { teamId: 'inhouse', monthlyCost: 250000 });
                appState.updateField('marketingTools', { 
                    selected: ['seo', 'ppc', 'social', 'email', 'analytics'], 
                    estimatedMonthlyCost: 300000 
                });

                // 2. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
                const formData = appState.getFormDataForComponents();
                
                // 3. –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞—Å—á–µ—Ç
                const currentCosts = formData.budget + (formData.marketingTeam?.monthlyCost || 0) + (formData.marketingTools?.estimatedMonthlyCost || 0);
                const steamphonyCosts = Math.round((formData.marketingTools?.estimatedMonthlyCost || 0) * 0.7);
                const savings = Math.max(currentCosts - steamphonyCosts, 0);
                const roi = steamphonyCosts > 0 ? Math.round((savings / steamphonyCosts) * 100) : 0;
                const payback = steamphonyCosts > 0 ? Math.round(steamphonyCosts / savings) : 0;

                resultDiv.innerHTML = `
                    <div class="test-result success">
                        ‚úÖ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!
                    </div>
                    <div class="test-result info">
                        <strong>–§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</strong><br>
                        üí∞ –≠–∫–æ–Ω–æ–º–∏—è: ${savings.toLocaleString()} ‚ÇΩ/–º–µ—Å<br>
                        üìà ROI: ${roi}%<br>
                        ‚è±Ô∏è –°—Ä–æ–∫ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏: ${payback} –º–µ—Å<br>
                        üè≠ –û—Ç—Ä–∞—Å–ª—å: ${formData.industry?.title}<br>
                        üìä –†–∞–∑–º–µ—Ä: ${formData.businessSize?.title}<br>
                        üíµ –ë—é–¥–∂–µ—Ç: ${formData.budget?.toLocaleString()} ‚ÇΩ/–º–µ—Å
                    </div>
                    <pre>${JSON.stringify(formData, null, 2)}</pre>
                `;
                
                console.log('‚úÖ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞: ${error.message}
                    </div>
                `;
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:', error);
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        });
    </script>
</body>
</html> 