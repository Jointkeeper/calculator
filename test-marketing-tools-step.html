<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Tools Step - Test Environment</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- CSS Styles -->
    <link rel="stylesheet" href="src/styles/main.css">
    
    <style>
        /* Test environment specific styles */
        .test-control-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 300px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            font-size: 14px;
        }
        
        .test-button {
            margin: 0.25rem;
            padding: 0.5rem 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #f8f9fa;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .test-button:hover {
            background: #e9ecef;
        }
        
        .test-button.active {
            background: #007bff;
            color: white;
        }
        
        .test-section {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .test-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 0.5rem;
            margin-top: 0.5rem;
            font-family: monospace;
            font-size: 11px;
            max-height: 100px;
            overflow-y: auto;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-indicator.success { background: #28a745; }
        .status-indicator.error { background: #dc3545; }
        .status-indicator.warning { background: #ffc107; }
        .status-indicator.info { background: #17a2b8; }
        
        body {
            margin: 0;
            padding: 2rem;
            background: #f5f7fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    </style>
</head>
<body>
    <!-- Test Control Panel -->
    <div class="test-control-panel">
        <h3 style="margin: 0 0 1rem 0; font-size: 16px; font-weight: 600;">🧪 Marketing Tools Step Test</h3>
        
        <!-- Industry Testing -->
        <div class="test-section">
            <strong>Industry Testing:</strong>
            <div style="margin-top: 0.5rem;">
                <button class="test-button" onclick="setTestIndustry('restaurant')">Restaurant</button>
                <button class="test-button" onclick="setTestIndustry('beauty')">Beauty</button>
                <button class="test-button" onclick="setTestIndustry('retail')">Retail</button>
                <button class="test-button" onclick="setTestIndustry('services')">Services</button>
                <button class="test-button" onclick="setTestIndustry('default')">Default</button>
            </div>
        </div>
        
        <!-- Feature Testing -->
        <div class="test-section">
            <strong>Feature Tests:</strong>
            <div style="margin-top: 0.5rem;">
                <button class="test-button" onclick="testToolSelection()">Tool Selection</button>
                <button class="test-button" onclick="testOptimizationSuggestions()">Optimization</button>
                <button class="test-button" onclick="testValidation()">Validation</button>
                <button class="test-button" onclick="testAnalytics()">Analytics</button>
            </div>
        </div>
        
        <!-- Debug Actions -->
        <div class="test-section">
            <strong>Debug:</strong>
            <div style="margin-top: 0.5rem;">
                <button class="test-button" onclick="logFormData()">Log Data</button>
                <button class="test-button" onclick="resetComponent()">Reset</button>
                <button class="test-button" onclick="toggleLogging()">Toggle Log</button>
            </div>
        </div>
        
        <!-- Status -->
        <div class="test-section">
            <strong>Status:</strong>
            <div id="status-display" style="margin-top: 0.5rem;">
                <div><span class="status-indicator info"></span>Component Loading...</div>
            </div>
        </div>
        
        <!-- Live Log -->
        <div id="test-log" class="test-log" style="display: none;"></div>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <h1 style="text-align: center; margin-bottom: 2rem; color: #2563eb;">
            📱 Marketing Tools Step Test Environment
        </h1>
        
        <!-- Marketing Tools Step Container -->
        <div id="marketing-tools-step" class="step-container">
            <!-- MarketingToolsStep.js will render content here -->
        </div>
    </div>

    <!-- Scripts -->
    <script src="src/components/MarketingToolsStep.js"></script>
    
    <script>
        // Test Environment Setup
        let marketingToolsStep = null;
        let testLogging = false;
        let testData = {
            analytics: [],
            interactions: []
        };

        // Mock app global object
        window.app = {
            formData: {
                industry: { key: 'restaurant', title: 'Ресторан' },
                businessSize: { key: 'medium_restaurant', title: 'Средний ресторан (50-100 посадочных мест)' },
                marketingBudget: {
                    monthly: 45000,
                    breakdown: { advertising: 24750, staff: 13500, tools: 4500, analytics: 2250 },
                    potentialSavings: { total: 27000, percentage: 60 }
                }
            },
            analytics: {
                trackEvent: function(eventName, params) {
                    testData.analytics.push({ event: eventName, params, timestamp: Date.now() });
                    log(`📊 Analytics: ${eventName}`, params);
                }
            }
        };

        // Initialize component on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeTestEnvironment();
        });

        function initializeTestEnvironment() {
            try {
                const container = document.querySelector('#marketing-tools-step');
                
                if (!container) {
                    updateStatus('error', 'Container not found');
                    return;
                }

                // Initialize MarketingToolsStep
                marketingToolsStep = new MarketingToolsStep(container, {
                    onSelect: function(data) {
                        testData.interactions.push({ type: 'select', data, timestamp: Date.now() });
                        log('🎯 Tool Selected:', data);
                    },
                    onNext: function(data) {
                        testData.interactions.push({ type: 'next', data, timestamp: Date.now() });
                        log('➡️ Next Clicked:', data);
                        updateStatus('success', 'Step completed successfully');
                    },
                    onBack: function(data) {
                        testData.interactions.push({ type: 'back', data, timestamp: Date.now() });
                        log('⬅️ Back Clicked:', data);
                    },
                    trackAnalytics: true
                });

                updateStatus('success', 'Component initialized successfully');
                log('✅ MarketingToolsStep initialized');
                
            } catch (error) {
                updateStatus('error', `Initialization failed: ${error.message}`);
                log('❌ Error:', error);
            }
        }

        // Industry Testing Functions
        function setTestIndustry(industryKey) {
            const industries = {
                restaurant: { key: 'restaurant', title: 'Ресторан' },
                beauty: { key: 'beauty', title: 'Салон красоты' },
                retail: { key: 'retail', title: 'Розничная торговля' },
                services: { key: 'services', title: 'Услуги' },
                default: { key: 'default', title: 'Другое' }
            };

            // Update mock data
            window.app.formData.industry = industries[industryKey];
            
            // Reset and reinitialize component
            resetComponent();
            initializeTestEnvironment();
            
            updateStatus('info', `Industry set to: ${industries[industryKey].title}`);
            log(`🏢 Industry changed to: ${industryKey}`);
            
            // Update button states
            document.querySelectorAll('.test-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Feature Testing Functions
        function testToolSelection() {
            if (!marketingToolsStep) {
                updateStatus('error', 'Component not initialized');
                return;
            }

            log('🧪 Testing tool selection...');
            
            // Simulate selecting some tools
            const testTools = ['instagram_ads', 'google_analytics', 'canva'];
            
            try {
                marketingToolsStep.setSelectedTools(testTools);
                updateStatus('success', `Selected ${testTools.length} tools for testing`);
                log(`✅ Tools selected: ${testTools.join(', ')}`);
                
                // Test getting selected tools
                const selectedTools = marketingToolsStep.getSelectedTools();
                log(`📋 Current selection: ${Array.from(selectedTools).join(', ')}`);
                
            } catch (error) {
                updateStatus('error', `Tool selection test failed: ${error.message}`);
                log('❌ Tool selection error:', error);
            }
        }

        function testOptimizationSuggestions() {
            log('🧪 Testing optimization suggestions...');
            
            // Select tools that should trigger optimization suggestions
            const toolsWithOptimizations = ['instagram_ads', 'facebook_ads', 'google_analytics', 'yandex_metrica'];
            
            try {
                marketingToolsStep.setSelectedTools(toolsWithOptimizations);
                
                // Wait for optimization calculations
                setTimeout(() => {
                    const optimizationPreview = document.querySelector('#optimization-preview');
                    if (optimizationPreview && optimizationPreview.style.display !== 'none') {
                        updateStatus('success', 'Optimization suggestions generated');
                        log('✅ Optimization suggestions are visible');
                    } else {
                        updateStatus('warning', 'No optimization suggestions shown');
                        log('⚠️ No optimization suggestions generated');
                    }
                }, 500);
                
            } catch (error) {
                updateStatus('error', `Optimization test failed: ${error.message}`);
                log('❌ Optimization test error:', error);
            }
        }

        function testValidation() {
            log('🧪 Testing validation...');
            
            try {
                // Test with no tools selected
                marketingToolsStep.reset();
                
                const nextButton = document.querySelector('#tools-next-btn');
                if (nextButton && nextButton.disabled) {
                    updateStatus('success', 'Validation working - Next button disabled');
                    log('✅ Validation: Next button properly disabled with no selection');
                } else {
                    updateStatus('warning', 'Validation issue - Next button should be disabled');
                    log('⚠️ Validation: Next button not disabled');
                }
                
                // Test with tools selected
                marketingToolsStep.setSelectedTools(['instagram_ads']);
                
                setTimeout(() => {
                    if (nextButton && !nextButton.disabled) {
                        updateStatus('success', 'Validation working - Next button enabled');
                        log('✅ Validation: Next button properly enabled with selection');
                    } else {
                        updateStatus('warning', 'Validation issue - Next button should be enabled');
                        log('⚠️ Validation: Next button not enabled');
                    }
                }, 100);
                
            } catch (error) {
                updateStatus('error', `Validation test failed: ${error.message}`);
                log('❌ Validation test error:', error);
            }
        }

        function testAnalytics() {
            log('🧪 Testing analytics...');
            
            const initialAnalyticsCount = testData.analytics.length;
            
            try {
                // Trigger analytics events
                marketingToolsStep.setSelectedTools(['instagram_ads']);
                
                setTimeout(() => {
                    const newAnalyticsCount = testData.analytics.length;
                    const eventsGenerated = newAnalyticsCount - initialAnalyticsCount;
                    
                    if (eventsGenerated > 0) {
                        updateStatus('success', `Analytics working - ${eventsGenerated} events generated`);
                        log(`✅ Analytics: ${eventsGenerated} events tracked`);
                        
                        // Show recent events
                        testData.analytics.slice(-3).forEach(event => {
                            log(`   📊 ${event.event}: ${Object.keys(event.params).length} params`);
                        });
                    } else {
                        updateStatus('warning', 'No analytics events generated');
                        log('⚠️ Analytics: No events tracked');
                    }
                }, 200);
                
            } catch (error) {
                updateStatus('error', `Analytics test failed: ${error.message}`);
                log('❌ Analytics test error:', error);
            }
        }

        // Debug Functions
        function logFormData() {
            log('📋 Current Form Data:', window.app.formData);
            
            if (marketingToolsStep) {
                const selectedTools = marketingToolsStep.getSelectedTools();
                log('🎯 Selected Tools:', Array.from(selectedTools));
            }
            
            log('📊 Analytics Events:', testData.analytics);
            log('🔄 Interactions:', testData.interactions);
        }

        function resetComponent() {
            if (marketingToolsStep) {
                try {
                    marketingToolsStep.reset();
                    updateStatus('info', 'Component reset');
                    log('🔄 Component reset');
                } catch (error) {
                    updateStatus('error', `Reset failed: ${error.message}`);
                    log('❌ Reset error:', error);
                }
            }
        }

        function toggleLogging() {
            testLogging = !testLogging;
            const logElement = document.getElementById('test-log');
            
            if (testLogging) {
                logElement.style.display = 'block';
                updateStatus('info', 'Logging enabled');
            } else {
                logElement.style.display = 'none';
                updateStatus('info', 'Logging disabled');
            }
            
            event.target.textContent = testLogging ? 'Hide Log' : 'Show Log';
        }

        // Utility Functions
        function updateStatus(type, message) {
            const statusDisplay = document.getElementById('status-display');
            const indicator = statusDisplay.querySelector('.status-indicator');
            const text = statusDisplay.querySelector('div');
            
            indicator.className = `status-indicator ${type}`;
            text.innerHTML = `<span class="status-indicator ${type}"></span>${message}`;
        }

        function log(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            
            console.log(logMessage, data || '');
            
            if (testLogging) {
                const logElement = document.getElementById('test-log');
                const logLine = document.createElement('div');
                logLine.textContent = logMessage + (data ? ' ' + JSON.stringify(data, null, 2) : '');
                logElement.appendChild(logLine);
                logElement.scrollTop = logElement.scrollHeight;
            }
        }

        // Automated testing sequence
        function runAutomatedTests() {
            log('🚀 Starting automated test sequence...');
            
            setTimeout(() => testToolSelection(), 1000);
            setTimeout(() => testOptimizationSuggestions(), 2000);
            setTimeout(() => testValidation(), 3000);
            setTimeout(() => testAnalytics(), 4000);
            setTimeout(() => {
                updateStatus('success', 'Automated tests completed');
                log('✅ All automated tests completed');
            }, 5000);
        }

        // Run automated tests on component ready
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(runAutomatedTests, 2000);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1': setTestIndustry('restaurant'); e.preventDefault(); break;
                    case '2': setTestIndustry('beauty'); e.preventDefault(); break;
                    case '3': setTestIndustry('retail'); e.preventDefault(); break;
                    case 'r': resetComponent(); e.preventDefault(); break;
                    case 'l': toggleLogging(); e.preventDefault(); break;
                }
            }
        });
    </script>
</body>
</html> 